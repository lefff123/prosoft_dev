     1                                  section .data
     2 00000000 497420697320616E20-         helo db "It is an assembly calc!", 10
     2 00000009 617373656D626C7920-
     2 00000012 63616C63210A       
     3 00000018 507574203120696620-              db "Put 1 if you want to sum, put 2 if you want to subtract", 10  
     3 00000021 796F752077616E7420-
     3 0000002A 746F2073756D2C2070-
     3 00000033 757420322069662079-
     3 0000003C 6F752077616E742074-
     3 00000045 6F2073756274726163-
     3 0000004E 740A               
     4 00000050 496620796F75207761-              db "If you want to exit put 0", 10, 0
     4 00000059 6E7420746F20657869-
     4 00000062 742070757420300A00 
     5 0000006B 707574207468652066-         repeat1 db "put the first integer: ", 0
     5 00000074 6972737420696E7465-
     5 0000007D 6765723A2000       
     6 00000083 707574207468652073-         repeat2 db "put the second integer: ", 0
     6 0000008C 65636F6E6420696E74-
     6 00000095 656765723A2000     
     7 0000009C 6572726F720A00              err db "error", 10, 0
     8 000000A3 0A                          newline db 10
     9                                  
    10                                  section .bss
    11 00000000 ????????????????            number1 resq 1
    12 00000008 ????????????????            number2 resq 1
    13 00000010 ??                          sign resb 1
    14 00000011 <res 20h>                   buffer resb 32
    15 00000031 <res 20h>                   output resb 32
    16                                  
    17                                  global _start
    18                                  
    19                                  section .text
    20                                  _start:
    21                                  menu_loop:
    22 00000000 48C70425[00000000]-         mov qword [number1], 0
    22 00000008 00000000           
    23 0000000C 48C70425[08000000]-         mov qword [number2], 0
    23 00000014 00000000           
    24                                      
    25                                      ;вывод меню
    26 00000018 B801000000                  mov rax, 1
    27 0000001D BF01000000                  mov rdi, 1
    28 00000022 48BE-                       mov rsi, helo
    28 00000024 [0000000000000000] 
    29 0000002C BA6B000000                  mov rdx, 107
    30 00000031 0F05                        syscall
    31                                  
    32                                      ; чтение выбора
    33 00000033 B800000000                  mov rax, 0
    34 00000038 BF00000000                  mov rdi, 0
    35 0000003D 48BE-                       mov rsi, buffer
    35 0000003F [1100000000000000] 
    36 00000047 BA20000000                  mov rdx, 32
    37 0000004C 0F05                        syscall
    38                                  
    39 0000004E E8B0010000                  call atoi
    40                                  
    41 00000053 4883F800                    cmp rax, 0
    42 00000057 0F84BA000000                je exit
    43 0000005D 4883F801                    cmp rax, 1 
    44 00000061 7408                        je sum
    45 00000063 4883F802                    cmp rax, 2
    46 00000067 7458                        je subtract
    47 00000069 EB95                        jmp menu_loop
    48                                  
    49                                  sum:
    50 0000006B E8B1000000                  call enter_nums
    51 00000070 488B0425[00000000]          mov rax, [number1]
    52 00000078 48030425[08000000]          add rax, [number2]
    53 00000080 E823010000                  call to_str
    54                                      
    55                                      ; вывод результата
    56 00000085 B801000000                  mov rax, 1
    57 0000008A 4889FE                      mov rsi, rdi
    58 0000008D BF01000000                  mov rdi, 1
    59                                   
    60 00000092 48BA-                       mov rdx, output + 32
    60 00000094 [5100000000000000] 
    61 0000009C 4829FA                      sub rdx, rdi        ; вычисляем длину
    62 0000009F 0F05                        syscall
    63                                      
    64                                      ; Новая строка
    65 000000A1 B801000000                  mov rax, 1
    66 000000A6 BF01000000                  mov rdi, 1
    67 000000AB 48BE-                       mov rsi, newline
    67 000000AD [A300000000000000] 
    68 000000B5 BA01000000                  mov rdx, 1
    69 000000BA 0F05                        syscall
    70                                      
    71 000000BC E93FFFFFFF                  jmp menu_loop
    72                                  
    73                                  subtract:
    74 000000C1 E85B000000                  call enter_nums
    75 000000C6 488B0425[00000000]          mov rax, [number1]
    76 000000CE 482B0425[08000000]          sub rax, [number2]
    77 000000D6 E8CD000000                  call to_str
    78                                      
    79                                      ; вывод результата
    80 000000DB B801000000                  mov rax, 1
    81 000000E0 4889FE                      mov rsi, rdi
    82 000000E3 BF01000000                  mov rdi, 1
    83 000000E8 48BA-                       mov rdx, output + 32
    83 000000EA [5100000000000000] 
    84 000000F2 4829FA                      sub rdx, rdi
    85 000000F5 0F05                        syscall
    86                                      
    87                                      ; новая строка
    88 000000F7 B801000000                  mov rax, 1
    89 000000FC BF01000000                  mov rdi, 1
    90 00000101 48BE-                       mov rsi, newline
    90 00000103 [A300000000000000] 
    91 0000010B BA01000000                  mov rdx, 1
    92 00000110 0F05                        syscall
    93                                      
    94 00000112 E9E9FEFFFF                  jmp menu_loop
    95                                  
    96                                  exit:
    97 00000117 B83C000000                  mov rax, 60
    98 0000011C 4831FF                      xor rdi, rdi
    99 0000011F 0F05                        syscall
   100                                  
   101                                  enter_nums:
   102                                    
   103 00000121 B801000000                  mov rax, 1
   104 00000126 BF01000000                  mov rdi, 1
   105 0000012B 48BE-                       mov rsi, repeat1
   105 0000012D [6B00000000000000] 
   106 00000135 BA16000000                  mov rdx, 22
   107 0000013A 0F05                        syscall
   108                                  
   109 0000013C B800000000                  mov rax, 0
   110 00000141 BF00000000                  mov rdi, 0
   111 00000146 48BE-                       mov rsi, buffer
   111 00000148 [1100000000000000] 
   112 00000150 BA20000000                  mov rdx, 32
   113 00000155 0F05                        syscall
   114                                  
   115 00000157 E8A7000000                  call atoi
   116 0000015C 48890425[00000000]          mov qword [number1], rax
   117                                  
   118                                     
   119 00000164 B801000000                  mov rax, 1
   120 00000169 BF01000000                  mov rdi, 1
   121 0000016E 48BE-                       mov rsi, repeat2
   121 00000170 [8300000000000000] 
   122 00000178 BA17000000                  mov rdx, 23
   123 0000017D 0F05                        syscall
   124                                  
   125                                      
   126 0000017F B800000000                  mov rax, 0
   127 00000184 BF00000000                  mov rdi, 0
   128 00000189 48BE-                       mov rsi, buffer
   128 0000018B [1100000000000000] 
   129 00000193 BA20000000                  mov rdx, 32
   130 00000198 0F05                        syscall
   131                                  
   132 0000019A E864000000                  call atoi
   133 0000019F 48890425[08000000]          mov qword [number2], rax
   134 000001A7 C3                          ret
   135                                  
   136                                  to_str:
   137 000001A8 48BF-                       mov rdi, output
   137 000001AA [3100000000000000] 
   138 000001B2 4883C71F                    add rdi, 31
   139 000001B6 C60700                      mov byte [rdi], 0   
   140 000001B9 4889C6                      mov rsi, rax      
   141 000001BC BB0A000000                  mov rbx, 10
   142                                      
   143 000001C1 4885F6                      test rsi, rsi
   144 000001C4 790D                        jns positive
   145                                  
   146 000001C6 48F7DE                      neg rsi
   147 000001C9 C60425[10000000]2D          mov byte [sign], '-'
   148 000001D1 EB08                        jmp conv
   149                                      
   150                                  
   151                                      positive:
   152 000001D3 C60425[10000000]2B              mov byte [sign], '+'
   153                                  
   154                                      conv:
   155 000001DB 4885F6                          test rsi, rsi
   156 000001DE 7416                            je dn
   157                                          
   158                                          ; ПОДГОТОВКА ДЕЛЕНИЯ
   159 000001E0 4889F0                          mov rax, rsi        ; делимое в rax
   160 000001E3 4831D2                          xor rdx, rdx        
   161 000001E6 48F7F3                          div rbx             ; rax частное, rdx остаток
   162                                          
   163 000001E9 4889C6                          mov rsi, rax        ; обновляем число
   164                                          
   165 000001EC 80C230                          add dl, '0'         
   166 000001EF 48FFCF                          dec rdi
   167 000001F2 8817                            mov byte [rdi], dl
   168                                          
   169 000001F4 EBE5                            jmp conv
   170                                  
   171                                      dn: 
   172 000001F6 48FFCF                          dec rdi
   173 000001F9 8A0425[10000000]                mov al, [sign]
   174 00000200 8807                            mov byte[rdi], al
   175 00000202 C3                              ret
   176                                  
   177                                  atoi:
   178 00000203 48BF-                       mov rdi, buffer
   178 00000205 [1100000000000000] 
   179 0000020D 4831C0                      xor rax, rax        
   180 00000210 4831C9                      xor rcx, rcx       
   181                                     
   182                                      convert:
   183 00000213 8A0F                            mov cl, byte [rdi]  
   184                                          
   185                                          ; проверка конца строки
   186 00000215 84C9                            test cl, cl
   187 00000217 7445                            je done
   188 00000219 80F90A                          cmp cl, 10          ; новая строка
   189 0000021C 7440                            je done
   190 0000021E 80F90D                          cmp cl, 13          ; возврат каретки
   191 00000221 743B                            je done
   192                                          
   193                                          ; Проверка что это цифра
   194 00000223 80F930                          cmp cl, '0'
   195 00000226 7C14                            jl error
   196 00000228 80F939                          cmp cl, '9'
   197 0000022B 7F0F                            jg error
   198                                          
   199                                          
   200 0000022D 80E930                          sub cl, '0'
   201                                          
   202                                          ; уножение на 10 и добавление цифры
   203 00000230 486BC00A                        imul rax, 10
   204 00000234 4801C8                          add rax, rcx
   205                                          
   206 00000237 48FFC7                          inc rdi
   207 0000023A EBD7                            jmp convert
   208                                  
   209                                      error:
   210                                          
   211 0000023C B801000000                      mov rax, 1
   212 00000241 BF01000000                      mov rdi, 1
   213 00000246 48BE-                           mov rsi, err
   213 00000248 [9C00000000000000] 
   214 00000250 BA06000000                      mov rdx, 6
   215 00000255 0F05                            syscall
   216 00000257 B83C000000                      mov rax, 60
   217 0000025C 0F05                            syscall
   218                                  
   219                                      done:
   220 0000025E C3                              ret
